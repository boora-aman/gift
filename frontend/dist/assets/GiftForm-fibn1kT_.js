import{_ as L,b as O,D as P,E as X,v as z,u as x,H as M,I as R,w as H,c as s,o as l,l as n,a as t,m as p,n as w,t as f,q as J,p as U,J as _,K as k,L as K,F as I,s as C,M as Q,N as Y,G as Z,O as $,z as ee}from"./index-ChsQcVH8.js";import{r as te}from"./PhotoIcon-D2x7iyB1.js";import{r as oe}from"./TrashIcon-B1nwDLsP.js";const ae={name:"GiftForm",components:{TrashIcon:oe,PhotoIcon:te,XMarkIcon:X,ArrowPathIcon:P,ExclamationTriangleIcon:O},props:{initialData:{type:Object,default:()=>({})},isEditMode:{type:Boolean,default:!1},giftStatus:{type:String,default:"Available"}},emits:["submit"],setup(b,{emit:o}){const{showNotification:u}=ee(),e=z({gift_name:"",category:"",value:"",description:"",status:"Available",gift_additional_attributes:[],gift_images:[]}),g=x({}),S=x(!1),h=x(""),y=x([]),v=x(!1),E=x(null),F=M(()=>b.isEditMode&&b.giftStatus==="Issued"),r=M(()=>!b.isEditMode||b.giftStatus==="Available"),c=async()=>{try{v.value=!0;const a=await Z.getCategories();if(a.success){const i=a.data||[];y.value=i.map(d=>({name:d.category_name,category_name:d.category_name}))}else console.error("Failed to load categories:",a.error),y.value=[{name:"Watch",category_name:"Watch"},{name:"Mobile",category_name:"Mobile"},{name:"Product",category_name:"Product"},{name:"Service",category_name:"Service"},{name:"Digital",category_name:"Digital"}]}catch(a){console.error("Error loading categories:",a),y.value=[{name:"Watch",category_name:"Watch"},{name:"Mobile",category_name:"Mobile"},{name:"Product",category_name:"Product"},{name:"Service",category_name:"Service"},{name:"Digital",category_name:"Digital"}]}finally{v.value=!1}},m=()=>{e.gift_additional_attributes.push({attribute_name:"",attribute_value:""})},V=a=>{e.gift_additional_attributes.splice(a,1)},G=async a=>{const i=Array.from(a.target.files);for(const d of i)try{const A=await $.upload(d);A.success?e.gift_images.push({image:A.data.file_url}):u(`Failed to upload ${d.name}`,"error")}catch(A){console.error("File upload error:",A),u(`Failed to upload ${d.name}`,"error")}a.target.value=""},T=a=>{e.gift_images.splice(a,1)},B=a=>{if(!a)return"";if(a.startsWith("http://")||a.startsWith("https://"))return a;const d=window.location.origin;return a.startsWith("/files/")?`${d}${a}`:a.startsWith("/")?`${d}${a}`:`${d}/files/${a}`},N=(a,i=!1)=>({available:i?"border-emerald-300":"bg-gray-100 text-gray-800",issued:i?"border-blue-300":"bg-blue-100 text-blue-800",expired:i?"border-red-300":"bg-red-100 text-red-800",cancelled:i?"border-charcoal-300":"bg-charcoal-100 text-charcoal-800",redeemed:i?"border-purple-300":"bg-purple-100 text-purple-800"})[a==null?void 0:a.toLowerCase()]||(i?"border-emerald-300":"bg-gray-100 text-gray-800"),W=a=>({available:"Available",issued:"Issued",expired:"Expired",cancelled:"Cancelled",redeemed:"Redeemed"})[a==null?void 0:a.toLowerCase()]||"Available",j=()=>(g.value={},e.gift_name.trim()||(g.value.gift_name="Gift name is required"),e.category||(g.value.category="Category is required"),(!e.value||e.value<=0)&&(g.value.value="Value must be greater than 0"),Object.keys(g.value).length===0),q=()=>{j()&&(h.value="submit",o("submit",{...e}))},D=()=>{h.value=""};return R(()=>b.initialData,a=>{a&&Object.keys(a).length>0&&(e.gift_name=a.gift_name||"",e.category=a.category||"",e.value=a.value||"",e.description=a.description||"",e.status=a.status||"Available",e.gift_additional_attributes=a.gift_additional_attributes||[],e.gift_images=a.gift_images||[])},{deep:!0,immediate:!0}),H(()=>{c()}),{form:e,errors:g,loading:S,saving:h,categories:y,categoriesLoading:v,fileInput:E,isValueDisabled:F,isFieldEditable:r,addAttribute:m,removeAttribute:V,handleFileUpload:G,removeImage:T,getImageUrl:B,getStatusClasses:N,getStatusText:W,handleSubmit:q,resetSaving:D}}},re={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},le={class:"flex items-start"},se={class:"text-sm text-amber-700 mt-1"},ie={class:"bg-white rounded-xl shadow-card p-6"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ne={key:0},ce=["value"],be={key:0,class:"mt-1 text-xs text-amber-600"},ue=["disabled"],ge={key:0,class:"mt-1 text-sm text-red-600"},me=["disabled"],fe=["value"],he={key:0,class:"mt-1 text-sm text-red-600"},ye={class:"relative"},xe=["disabled"],_e={key:0,class:"mt-1 text-sm text-red-600"},ve={key:1,class:"mt-1 text-xs text-charcoal-500"},pe={class:"mt-6"},we=["disabled"],ke={key:0,class:"mt-1 text-sm text-red-600"},Ae={class:"bg-white rounded-xl shadow-card p-6"},Ee={class:"flex items-center justify-between mb-6"},Fe=["disabled"],Ie={key:0,class:"text-center py-8 text-charcoal-500 border-2 border-dashed border-charcoal-200 rounded-lg"},Ce={key:1,class:"space-y-4"},Se={class:"flex-1"},Me=["onUpdate:modelValue","disabled"],Ue={class:"flex-1"},Ve=["onUpdate:modelValue","disabled"],Ge=["onClick","disabled"],Te={class:"pt-2"},Be=["disabled"],Ne={class:"bg-white rounded-xl shadow-card p-6"},We={class:"flex items-center justify-between mb-6"},je=["disabled"],qe=["disabled"],De={key:0,class:"text-center py-8 text-charcoal-500 border-2 border-dashed border-charcoal-200 rounded-lg"},Le={class:"mx-auto w-12 h-12 text-charcoal-400 mb-4"},Oe={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Pe={class:"aspect-square rounded-lg overflow-hidden bg-charcoal-100"},Xe=["src","alt"],ze=["onClick","disabled"],Re={class:"flex justify-end"},He=["disabled"];function Je(b,o,u,e,g,S){const h=w("ExclamationTriangleIcon"),y=w("TrashIcon"),v=w("PhotoIcon"),E=w("XMarkIcon"),F=w("ArrowPathIcon");return l(),s("form",{onSubmit:o[8]||(o[8]=Y((...r)=>e.handleSubmit&&e.handleSubmit(...r),["prevent"])),class:"space-y-8"},[u.isEditMode&&!e.isFieldEditable?(l(),s("div",re,[t("div",le,[p(h,{class:"w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0"}),t("div",null,[o[9]||(o[9]=t("h3",{class:"text-sm font-medium text-amber-800"},"Gift Cannot Be Modified",-1)),t("p",se,' This gift cannot be edited because its status is "'+f(e.getStatusText(e.form.status))+'". Only gifts with "Available" status can be modified. ',1)])])])):n("",!0),t("div",ie,[o[18]||(o[18]=t("h2",{class:"text-xl font-semibold text-charcoal-900 mb-6"},"Basic Information",-1)),t("div",de,[u.isEditMode?(l(),s("div",ne,[o[11]||(o[11]=t("label",{for:"status",class:"block text-sm font-medium text-charcoal-700 mb-2"}," Status ",-1)),t("input",{id:"status",value:e.getStatusText(e.form.status),type:"text",readonly:"",class:J(["w-full px-3 py-2 border rounded-lg text-charcoal-900 bg-charcoal-50 cursor-not-allowed",e.getStatusClasses(e.form.status,!0)])},null,10,ce),e.isFieldEditable?n("",!0):(l(),s("p",be,[p(h,{class:"w-3 h-3 inline mr-1"}),o[10]||(o[10]=U(' Information can only be edited when status is "Available" ',-1))]))])):n("",!0),t("div",null,[o[12]||(o[12]=t("label",{for:"gift_name",class:"block text-sm font-medium text-charcoal-700 mb-2"}," Gift Name * ",-1)),_(t("input",{id:"gift_name","onUpdate:modelValue":o[0]||(o[0]=r=>e.form.gift_name=r),type:"text",required:"",disabled:!e.isFieldEditable,class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent disabled:bg-charcoal-50 disabled:cursor-not-allowed",placeholder:"Enter gift name"},null,8,ue),[[k,e.form.gift_name]]),e.errors.gift_name?(l(),s("p",ge,f(e.errors.gift_name),1)):n("",!0)]),t("div",null,[o[14]||(o[14]=t("label",{for:"category",class:"block text-sm font-medium text-charcoal-700 mb-2"}," Category * ",-1)),_(t("select",{id:"category","onUpdate:modelValue":o[1]||(o[1]=r=>e.form.category=r),required:"",disabled:e.categoriesLoading||!e.isFieldEditable,class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent disabled:bg-charcoal-50 disabled:cursor-not-allowed"},[o[13]||(o[13]=t("option",{value:""},"Select category",-1)),(l(!0),s(I,null,C(e.categories,r=>(l(),s("option",{key:r.name,value:r.name},f(r.category_name),9,fe))),128))],8,me),[[K,e.form.category]]),e.errors.category?(l(),s("p",he,f(e.errors.category),1)):n("",!0)]),t("div",null,[o[16]||(o[16]=t("label",{for:"value",class:"block text-sm font-medium text-charcoal-700 mb-2"}," Value (AED) * ",-1)),t("div",ye,[o[15]||(o[15]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-charcoal-500 text-sm"},"AED")],-1)),_(t("input",{id:"value","onUpdate:modelValue":o[2]||(o[2]=r=>e.form.value=r),type:"number",step:"0.01",min:"0",required:"",disabled:e.isValueDisabled||!e.isFieldEditable,class:"w-full pl-12 pr-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent disabled:bg-charcoal-50 disabled:cursor-not-allowed",placeholder:"0.00"},null,8,xe),[[k,e.form.value,void 0,{number:!0}]])]),e.errors.value?(l(),s("p",_e,f(e.errors.value),1)):n("",!0),e.isValueDisabled?(l(),s("p",ve," Gift value cannot be changed after issuance ")):n("",!0)])]),t("div",pe,[o[17]||(o[17]=t("label",{for:"description",class:"block text-sm font-medium text-charcoal-700 mb-2"}," Description ",-1)),_(t("textarea",{id:"description","onUpdate:modelValue":o[3]||(o[3]=r=>e.form.description=r),rows:"4",disabled:!e.isFieldEditable,class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent disabled:bg-charcoal-50 disabled:cursor-not-allowed",placeholder:"Enter gift description"},null,8,we),[[k,e.form.description]]),e.errors.description?(l(),s("p",ke,f(e.errors.description),1)):n("",!0)])]),t("div",Ae,[t("div",Ee,[o[19]||(o[19]=t("h2",{class:"text-xl font-semibold text-charcoal-900"},"Additional Attributes",-1)),t("button",{type:"button",onClick:o[4]||(o[4]=(...r)=>e.addAttribute&&e.addAttribute(...r)),disabled:!e.isFieldEditable,class:"px-4 py-2 text-sm font-medium text-gray-800 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-charcoal-50 disabled:text-charcoal-500 disabled:border-charcoal-200"}," Add Attribute ",8,Fe)]),e.form.gift_additional_attributes.length===0?(l(),s("div",Ie,[...o[20]||(o[20]=[t("p",{class:"text-sm"},"No additional attributes added yet.",-1),t("p",{class:"text-xs mt-1"},'Click "Add Attribute" to include extra details about this gift.',-1)])])):(l(),s("div",Ce,[(l(!0),s(I,null,C(e.form.gift_additional_attributes,(r,c)=>(l(),s("div",{key:c,class:"flex items-center space-x-4 p-4 bg-charcoal-50 rounded-lg"},[t("div",Se,[_(t("input",{"onUpdate:modelValue":m=>r.attribute_name=m,type:"text",disabled:!e.isFieldEditable,class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent disabled:bg-charcoal-100 disabled:cursor-not-allowed",placeholder:"Attribute name (e.g., Brand, Color)"},null,8,Me),[[k,r.attribute_name]])]),t("div",Ue,[_(t("input",{"onUpdate:modelValue":m=>r.attribute_value=m,type:"text",disabled:!e.isFieldEditable,class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent disabled:bg-charcoal-100 disabled:cursor-not-allowed",placeholder:"Attribute value (e.g., Apple, Red)"},null,8,Ve),[[k,r.attribute_value]])]),t("button",{type:"button",onClick:m=>e.removeAttribute(c),disabled:!e.isFieldEditable,class:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:text-charcoal-400"},[p(y,{class:"w-4 h-4"})],8,Ge)]))),128)),t("div",Te,[t("button",{type:"button",onClick:o[5]||(o[5]=(...r)=>e.addAttribute&&e.addAttribute(...r)),disabled:!e.isFieldEditable,class:"w-full px-4 py-3 text-sm font-medium text-gray-800 bg-gray-50 border border-gray-200 border-dashed rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-charcoal-50 disabled:text-charcoal-500 disabled:border-charcoal-200"}," + Add Another Attribute ",8,Be)])]))]),t("div",Ne,[t("div",We,[o[21]||(o[21]=t("h2",{class:"text-xl font-semibold text-charcoal-900"},"Images",-1)),t("button",{type:"button",onClick:o[6]||(o[6]=r=>b.$refs.fileInput.click()),disabled:!e.isFieldEditable,class:"px-4 py-2 text-sm font-medium text-gray-800 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-charcoal-50 disabled:text-charcoal-500 disabled:border-charcoal-200"}," Upload Images ",8,je)]),t("input",{ref:"fileInput",type:"file",multiple:"",accept:"image/*",onChange:o[7]||(o[7]=(...r)=>e.handleFileUpload&&e.handleFileUpload(...r)),class:"hidden",disabled:!e.isFieldEditable},null,40,qe),e.form.gift_images.length===0?(l(),s("div",De,[t("div",Le,[p(v,{class:"w-full h-full"})]),o[22]||(o[22]=t("p",{class:"text-sm"},"No images uploaded yet.",-1)),o[23]||(o[23]=t("p",{class:"text-xs mt-1"},'Click "Upload Images" to add photos of this gift.',-1))])):(l(),s("div",Oe,[(l(!0),s(I,null,C(e.form.gift_images,(r,c)=>(l(),s("div",{key:c,class:"relative group"},[t("div",Pe,[t("img",{src:e.getImageUrl(r.image),alt:`Gift image ${c+1}`,class:"w-full h-full object-cover"},null,8,Xe)]),t("button",{type:"button",onClick:m=>e.removeImage(c),disabled:!e.isFieldEditable,class:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-charcoal-400"},[p(E,{class:"w-4 h-4"})],8,ze)]))),128))]))]),t("div",Re,[t("button",{type:"submit",disabled:e.loading||u.isEditMode&&!e.isFieldEditable,class:"px-8 py-3 text-sm font-medium text-white bg-gray-600 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-charcoal-400"},[e.saving==="submit"?(l(),Q(F,{key:0,class:"inline w-4 h-4 mr-2 animate-spin"})):n("",!0),U(" "+f(u.isEditMode?e.saving==="submit"?"Updating Gift...":"Update Gift":e.loading?"Creating Gift...":"Create Gift"),1)],8,He)])],32)}const Ze=L(ae,[["render",Je],["__scopeId","data-v-2dc7c9fe"]]);export{Ze as G};
