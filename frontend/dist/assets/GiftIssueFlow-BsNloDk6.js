import{_ as ue,W as De,b as he,D as ge,E as be,u as A,w as ve,x as Le,c as _,o as b,a as o,m as $,n as F,l as z,q as oe,M as ie,t as U,i as Fe,v as Pe,J as se,K as ne,$ as Ge,a0 as je,e as Ue,j as $e,k as ze,p as ce,N as Be,F as we,s as _e,y as We,G as Ve,C as qe,T as xe,z as Ye,O as He}from"./index-ChsQcVH8.js";import{r as Ae,a as Te,g as Ke}from"./_commonjsHelpers-M7LEysT9.js";import{r as Je}from"./PhotoIcon-D2x7iyB1.js";const Xe={name:"CameraModal",components:{XMarkIcon:be,BoltIcon:Te,BoltSlashIcon:Ae,ArrowPathIcon:ge,ExclamationTriangleIcon:he,CameraIcon:De},emits:["close","photo-captured"],setup(n,{emit:e}){const c=A(null),t=A(null),w=A(!1),S=A(!0),f=A(!1),p=A(!1),P=A(!1),T=A("");let k=null,h=[];const m=async()=>{try{T.value="",h=(await navigator.mediaDevices.enumerateDevices()).filter(W=>W.kind==="videoinput"),f.value=h.length>1;const d={video:{facingMode:S.value?"user":"environment",width:{ideal:1280},height:{ideal:1280}},audio:!1};if(k=await navigator.mediaDevices.getUserMedia(d),c.value){c.value.srcObject=k,await new Promise(O=>{c.value.onloadedmetadata=O});const V=k.getVideoTracks()[0].getCapabilities();p.value=!!V.torch,w.value=!0}}catch(D){console.error("Camera initialization error:",D),D.name==="NotAllowedError"?T.value="Camera permission denied. Please allow camera access and try again.":D.name==="NotFoundError"?T.value="No camera found. Please ensure your device has a camera.":D.name==="NotReadableError"?T.value="Camera is being used by another application.":T.value="Unable to access camera. Please check your device settings.",w.value=!1}},R=async()=>{f.value&&(k&&k.getTracks().forEach(D=>D.stop()),S.value=!S.value,w.value=!1,await m())},I=async()=>{if(!(!p.value||!k))try{await k.getVideoTracks()[0].applyConstraints({advanced:[{torch:!P.value}]}),P.value=!P.value}catch(D){console.error("Flash toggle error:",D)}},N=()=>{if(!c.value||!t.value||!w.value)return;const D=c.value,d=t.value,W=d.getContext("2d");d.width=D.videoWidth,d.height=D.videoHeight,W.drawImage(D,0,0,d.width,d.height),d.toBlob(V=>{V&&e("photo-captured",V)},"image/jpeg",.9)},B=()=>{k&&(k.getTracks().forEach(D=>D.stop()),k=null),w.value=!1};return ve(()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){T.value="Camera not supported on this device";return}m()}),Le(()=>{B()}),{videoElement:c,canvasElement:t,cameraReady:w,isFrontCamera:S,hasMultipleCameras:f,hasFlash:p,flashOn:P,error:T,initializeCamera:m,switchCamera:R,toggleFlash:I,capturePhoto:N}}},Ze={class:"fixed inset-0 bg-black bg-opacity-90 z-50"},Qe={class:"h-full flex flex-col"},et={class:"flex items-center justify-between p-4 bg-black text-white safe-area-padding"},tt={class:"flex items-center space-x-3"},ot={class:"flex items-center space-x-2"},at=["disabled"],rt=["disabled"],st={class:"flex-1 relative overflow-hidden"},nt={ref:"canvasElement",class:"hidden"},it={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-90"},lt={class:"bg-white rounded-xl p-6 mx-4 text-center max-w-md"},ct={class:"text-charcoal-600 mb-4"},dt={class:"flex space-x-3"},ut={class:"absolute inset-0 flex items-center justify-center pointer-events-none"},mt=["disabled"],ft={class:"bg-black text-white p-4 safe-area-padding"},ht={class:"text-center"},gt={class:"text-white/80 text-sm mb-2"},bt={class:"text-white/60 text-xs"};function vt(n,e,c,t,w,S){const f=F("CameraIcon"),p=F("BoltIcon"),P=F("BoltSlashIcon"),T=F("ArrowPathIcon"),k=F("XMarkIcon"),h=F("ExclamationTriangleIcon");return b(),_("div",Ze,[o("div",Qe,[o("div",et,[o("div",tt,[$(f,{class:"w-6 h-6 text-white"}),e[6]||(e[6]=o("h2",{class:"text-lg font-semibold"},"Take Photo",-1))]),o("div",ot,[t.hasFlash?(b(),_("button",{key:0,onClick:e[0]||(e[0]=(...m)=>t.toggleFlash&&t.toggleFlash(...m)),disabled:!t.cameraReady,class:oe(["p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-200 disabled:opacity-50",{"bg-yellow-500 bg-opacity-80 hover:bg-yellow-500":t.flashOn}])},[t.flashOn?(b(),ie(P,{key:1,class:"w-5 h-5"})):(b(),ie(p,{key:0,class:"w-5 h-5"}))],10,at)):z("",!0),t.hasMultipleCameras?(b(),_("button",{key:1,onClick:e[1]||(e[1]=(...m)=>t.switchCamera&&t.switchCamera(...m)),disabled:!t.cameraReady,class:"p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-200 disabled:opacity-50"},[$(T,{class:"w-5 h-5"})],8,rt)):z("",!0),o("button",{onClick:e[2]||(e[2]=m=>n.$emit("close")),class:"p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-200"},[$(k,{class:"w-5 h-5"})])])]),o("div",st,[o("video",{ref:"videoElement",class:oe(["w-full h-full object-cover",{mirror:t.isFrontCamera}]),playsinline:"",muted:"",autoplay:""},null,2),o("canvas",nt,null,512),t.error?(b(),_("div",it,[o("div",lt,[$(h,{class:"w-12 h-12 text-red-500 mx-auto mb-4"}),e[7]||(e[7]=o("h3",{class:"text-lg font-semibold text-charcoal-900 mb-2"}," Camera Error ",-1)),o("p",ct,U(t.error),1),o("div",dt,[o("button",{onClick:e[3]||(e[3]=(...m)=>t.initializeCamera&&t.initializeCamera(...m)),class:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Try Again "),o("button",{onClick:e[4]||(e[4]=m=>n.$emit("close")),class:"flex-1 px-4 py-2 bg-charcoal-100 text-charcoal-700 rounded-lg hover:bg-charcoal-200 transition-colors"}," Cancel ")])])])):z("",!0),o("div",ut,[o("button",{onClick:e[5]||(e[5]=(...m)=>t.capturePhoto&&t.capturePhoto(...m)),disabled:!t.cameraReady,class:"w-20 h-20 rounded-full bg-white hover:bg-white/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center shadow-2xl border-4 border-white/50 pointer-events-auto"},[$(f,{class:"w-8 h-8 text-charcoal-900"})],8,mt)])]),o("div",ft,[o("div",ht,[o("p",gt,U(t.cameraReady?"Tap the camera button to take photo":"Preparing camera..."),1),o("p",bt,U(t.isFrontCamera?"Using front camera":"Using back camera"),1)])])])])}const pt=ue(Xe,[["render",vt],["__scopeId","data-v-d869838f"]]);var yt={exports:{}};(function(n){var e=function(c){var t=Object.prototype,w=t.hasOwnProperty,S=Object.defineProperty||function(r,s,i){r[s]=i.value},f,p=typeof Symbol=="function"?Symbol:{},P=p.iterator||"@@iterator",T=p.asyncIterator||"@@asyncIterator",k=p.toStringTag||"@@toStringTag";function h(r,s,i){return Object.defineProperty(r,s,{value:i,enumerable:!0,configurable:!0,writable:!0}),r[s]}try{h({},"")}catch{h=function(s,i,u){return s[i]=u}}function m(r,s,i,u){var a=s&&s.prototype instanceof W?s:W,l=Object.create(a.prototype),v=new g(u||[]);return S(l,"_invoke",{value:ae(r,i,v)}),l}c.wrap=m;function R(r,s,i){try{return{type:"normal",arg:r.call(s,i)}}catch(u){return{type:"throw",arg:u}}}var I="suspendedStart",N="suspendedYield",B="executing",D="completed",d={};function W(){}function V(){}function O(){}var Y={};h(Y,P,function(){return this});var X=Object.getPrototypeOf,K=X&&X(X(C([])));K&&K!==t&&w.call(K,P)&&(Y=K);var q=O.prototype=W.prototype=Object.create(Y);V.prototype=O,S(q,"constructor",{value:O,configurable:!0}),S(O,"constructor",{value:V,configurable:!0}),V.displayName=h(O,k,"GeneratorFunction");function ee(r){["next","throw","return"].forEach(function(s){h(r,s,function(i){return this._invoke(s,i)})})}c.isGeneratorFunction=function(r){var s=typeof r=="function"&&r.constructor;return s?s===V||(s.displayName||s.name)==="GeneratorFunction":!1},c.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,O):(r.__proto__=O,h(r,k,"GeneratorFunction")),r.prototype=Object.create(q),r},c.awrap=function(r){return{__await:r}};function J(r,s){function i(l,v,E,L){var j=R(r[l],r,v);if(j.type==="throw")L(j.arg);else{var te=j.arg,Z=te.value;return Z&&typeof Z=="object"&&w.call(Z,"__await")?s.resolve(Z.__await).then(function(Q){i("next",Q,E,L)},function(Q){i("throw",Q,E,L)}):s.resolve(Z).then(function(Q){te.value=Q,E(te)},function(Q){return i("throw",Q,E,L)})}}var u;function a(l,v){function E(){return new s(function(L,j){i(l,v,L,j)})}return u=u?u.then(E,E):E()}S(this,"_invoke",{value:a})}ee(J.prototype),h(J.prototype,T,function(){return this}),c.AsyncIterator=J,c.async=function(r,s,i,u,a){a===void 0&&(a=Promise);var l=new J(m(r,s,i,u),a);return c.isGeneratorFunction(s)?l:l.next().then(function(v){return v.done?v.value:l.next()})};function ae(r,s,i){var u=I;return function(l,v){if(u===B)throw new Error("Generator is already running");if(u===D){if(l==="throw")throw v;return x()}for(i.method=l,i.arg=v;;){var E=i.delegate;if(E){var L=y(E,i);if(L){if(L===d)continue;return L}}if(i.method==="next")i.sent=i._sent=i.arg;else if(i.method==="throw"){if(u===I)throw u=D,i.arg;i.dispatchException(i.arg)}else i.method==="return"&&i.abrupt("return",i.arg);u=B;var j=R(r,s,i);if(j.type==="normal"){if(u=i.done?D:N,j.arg===d)continue;return{value:j.arg,done:i.done}}else j.type==="throw"&&(u=D,i.method="throw",i.arg=j.arg)}}}function y(r,s){var i=s.method,u=r.iterator[i];if(u===f)return s.delegate=null,i==="throw"&&r.iterator.return&&(s.method="return",s.arg=f,y(r,s),s.method==="throw")||i!=="return"&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var a=R(u,r.iterator,s.arg);if(a.type==="throw")return s.method="throw",s.arg=a.arg,s.delegate=null,d;var l=a.arg;if(!l)return s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,d;if(l.done)s[r.resultName]=l.value,s.next=r.nextLoc,s.method!=="return"&&(s.method="next",s.arg=f);else return l;return s.delegate=null,d}ee(q),h(q,k,"Generator"),h(q,P,function(){return this}),h(q,"toString",function(){return"[object Generator]"});function M(r){var s={tryLoc:r[0]};1 in r&&(s.catchLoc=r[1]),2 in r&&(s.finallyLoc=r[2],s.afterLoc=r[3]),this.tryEntries.push(s)}function G(r){var s=r.completion||{};s.type="normal",delete s.arg,r.completion=s}function g(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(M,this),this.reset(!0)}c.keys=function(r){var s=Object(r),i=[];for(var u in s)i.push(u);return i.reverse(),function a(){for(;i.length;){var l=i.pop();if(l in s)return a.value=l,a.done=!1,a}return a.done=!0,a}};function C(r){if(r){var s=r[P];if(s)return s.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var i=-1,u=function a(){for(;++i<r.length;)if(w.call(r,i))return a.value=r[i],a.done=!1,a;return a.value=f,a.done=!0,a};return u.next=u}}return{next:x}}c.values=C;function x(){return{value:f,done:!0}}return g.prototype={constructor:g,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(G),!r)for(var s in this)s.charAt(0)==="t"&&w.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=f)},stop:function(){this.done=!0;var r=this.tryEntries[0],s=r.completion;if(s.type==="throw")throw s.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var s=this;function i(L,j){return l.type="throw",l.arg=r,s.next=L,j&&(s.method="next",s.arg=f),!!j}for(var u=this.tryEntries.length-1;u>=0;--u){var a=this.tryEntries[u],l=a.completion;if(a.tryLoc==="root")return i("end");if(a.tryLoc<=this.prev){var v=w.call(a,"catchLoc"),E=w.call(a,"finallyLoc");if(v&&E){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(v){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else if(E){if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,s){for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i];if(u.tryLoc<=this.prev&&w.call(u,"finallyLoc")&&this.prev<u.finallyLoc){var a=u;break}}a&&(r==="break"||r==="continue")&&a.tryLoc<=s&&s<=a.finallyLoc&&(a=null);var l=a?a.completion:{};return l.type=r,l.arg=s,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(l)},complete:function(r,s){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&s&&(this.next=s),d},finish:function(r){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.finallyLoc===r)return this.complete(i.completion,i.afterLoc),G(i),d}},catch:function(r){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc===r){var u=i.completion;if(u.type==="throw"){var a=u.arg;G(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(r,s,i){return this.delegate={iterator:C(r),resultName:s,nextLoc:i},this.method==="next"&&(this.arg=f),d}},c}(n.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(yt);var pe=(n,e)=>`${n}-${e}-${Math.random().toString(16).slice(3,8)}`;const wt=pe;let Ie=0;var Me=({id:n,action:e,payload:c={}})=>{let t=n;return typeof t>"u"&&(t=wt("Job",Ie),Ie+=1),{id:t,action:e,payload:c}},le={};let ye=!1;le.logging=ye;le.setLogging=n=>{ye=n};le.log=(...n)=>ye?console.log.apply(void 0,n):null;const _t=Me,{log:de}=le,xt=pe;let ke=0;var It=()=>{const n=xt("Scheduler",ke),e={},c={};let t=[];ke+=1;const w=()=>t.length,S=()=>Object.keys(e).length,f=()=>{if(t.length!==0){const h=Object.keys(e);for(let m=0;m<h.length;m+=1)if(typeof c[h[m]]>"u"){t[0](e[h[m]]);break}}},p=(h,m)=>new Promise((R,I)=>{const N=_t({action:h,payload:m});t.push(async B=>{t.shift(),c[B.id]=N;try{R(await B[h].apply(void 0,[...m,N.id]))}catch(D){I(D)}finally{delete c[B.id],f()}}),de(`[${n}]: Add ${N.id} to JobQueue`),de(`[${n}]: JobQueue length=${t.length}`),f()});return{addWorker:h=>(e[h.id]=h,de(`[${n}]: Add ${h.id}`),de(`[${n}]: Number of workers=${S()}`),f(),h.id),addJob:async(h,...m)=>{if(S()===0)throw Error(`[${n}]: You need to have at least one worker before adding jobs`);return p(h,m)},terminate:async()=>{Object.keys(e).forEach(async h=>{await e[h].terminate()}),t=[]},getQueueLen:w,getNumWorkers:S}};function kt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function Et(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var Ct=Et;const St=Ct;var Dt=n=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":St()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof kt=="function"&&(e.type="node"),typeof n>"u"?e:e[n]};const Lt=Dt("type")==="browser",Pt=Lt?n=>new URL(n,window.location.href).href:n=>n;var At=n=>{const e={...n};return["corePath","workerPath","langPath"].forEach(c=>{n[c]&&(e[c]=Pt(e[c]))}),e},Tt=n=>{const e=[],c=[],t=[],w=[],S=[];return n.blocks&&n.blocks.forEach(f=>{f.paragraphs.forEach(p=>{p.lines.forEach(P=>{P.words.forEach(T=>{T.symbols.forEach(k=>{S.push({...k,page:n,block:f,paragraph:p,line:P,word:T})}),w.push({...T,page:n,block:f,paragraph:p,line:P})}),t.push({...P,page:n,block:f,paragraph:p})}),c.push({...p,page:n,block:f})}),e.push({...f,page:n})}),{...n,blocks:e,paragraphs:c,lines:t,words:w,symbols:S}},Oe={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const Mt="5.1.1",Ot={version:Mt};var Rt={workerBlobURL:!0,logger:()=>{}};const Nt=Ot.version,Ft=Rt;var Gt={...Ft,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Nt}/dist/worker.min.js`},jt=({workerPath:n,workerBlobURL:e})=>{let c;if(Blob&&URL&&e){const t=new Blob([`importScripts("${n}");`],{type:"application/javascript"});c=new Worker(URL.createObjectURL(t))}else c=new Worker(n);return c},Ut=n=>{n.terminate()},$t=(n,e)=>{n.onmessage=({data:c})=>{e(c)}},zt=async(n,e)=>{n.postMessage(e)};const me=n=>new Promise((e,c)=>{const t=new FileReader;t.onload=()=>{e(t.result)},t.onerror=({target:{error:{code:w}}})=>{c(Error(`File could not be read! Code=${w}`))},t.readAsArrayBuffer(n)}),fe=async n=>{let e=n;if(typeof n>"u")return"undefined";if(typeof n=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(n)?e=atob(n.split(",")[1]).split("").map(c=>c.charCodeAt(0)):e=await(await fetch(n)).arrayBuffer();else if(typeof HTMLElement<"u"&&n instanceof HTMLElement)n.tagName==="IMG"&&(e=await fe(n.src)),n.tagName==="VIDEO"&&(e=await fe(n.poster)),n.tagName==="CANVAS"&&await new Promise(c=>{n.toBlob(async t=>{e=await me(t),c()})});else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas){const c=await n.convertToBlob();e=await me(c)}else(n instanceof File||n instanceof Blob)&&(e=await me(n));return new Uint8Array(e)};var Bt=fe;const Wt=Gt,Vt=jt,qt=Ut,Yt=$t,Ht=zt,Kt=Bt;var Jt={defaultOptions:Wt,spawnWorker:Vt,terminateWorker:qt,onMessage:Yt,send:Ht,loadImage:Kt};const Xt=At,Zt=Tt,H=Me,{log:Ee}=le,Qt=pe,re=Oe,{defaultOptions:eo,spawnWorker:to,terminateWorker:oo,onMessage:ao,loadImage:Ce,send:ro}=Jt;let Se=0;var Re=async(n="eng",e=re.LSTM_ONLY,c={},t={})=>{const w=Qt("Worker",Se),{logger:S,errorHandler:f,...p}=Xt({...eo,...c}),P={},T={},k=typeof n=="string"?n.split("+"):n;let h=e,m=t;const R=[re.DEFAULT,re.LSTM_ONLY].includes(e)&&!p.legacyCore;let I,N;const B=new Promise((a,l)=>{N=a,I=l}),D=a=>{I(a.message)};let d=to(p);d.onerror=D,Se+=1;const W=(a,l)=>{P[a]=l},V=(a,l)=>{T[a]=l},O=({id:a,action:l,payload:v})=>new Promise((E,L)=>{Ee(`[${w}]: Start ${a}, action=${l}`);const j=`${l}-${a}`;W(j,E),V(j,L),ro(d,{workerId:w,jobId:a,action:l,payload:v})}),Y=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),X=a=>O(H({id:a,action:"load",payload:{options:{lstmOnly:R,corePath:p.corePath,logging:p.logging}}})),K=(a,l,v)=>O(H({id:v,action:"FS",payload:{method:"writeFile",args:[a,l]}})),q=(a,l)=>O(H({id:l,action:"FS",payload:{method:"readFile",args:[a,{encoding:"utf8"}]}})),ee=(a,l)=>O(H({id:l,action:"FS",payload:{method:"unlink",args:[a]}})),J=(a,l,v)=>O(H({id:v,action:"FS",payload:{method:a,args:l}})),ae=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),y=(a,l)=>O(H({id:l,action:"loadLanguage",payload:{langs:a,options:{langPath:p.langPath,dataPath:p.dataPath,cachePath:p.cachePath,cacheMethod:p.cacheMethod,gzip:p.gzip,lstmOnly:[re.DEFAULT,re.LSTM_ONLY].includes(h)&&!p.legacyLang}}})),M=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),G=(a,l,v,E)=>O(H({id:E,action:"initialize",payload:{langs:a,oem:l,config:v}})),g=(a="eng",l,v,E)=>{if(R&&[re.TESSERACT_ONLY,re.TESSERACT_LSTM_COMBINED].includes(l))throw Error("Legacy model requested but code missing.");const L=l||h;h=L;const j=v||m;m=j;const Z=(typeof a=="string"?a.split("+"):a).filter(Q=>!k.includes(Q));return k.push(...Z),Z.length>0?y(Z,E).then(()=>G(a,L,j,E)):G(a,L,j,E)},C=(a={},l)=>O(H({id:l,action:"setParameters",payload:{params:a}})),x=async(a,l={},v={blocks:!0,text:!0,hocr:!0,tsv:!0},E)=>O(H({id:E,action:"recognize",payload:{image:await Ce(a),options:l,output:v}})),r=(a="Tesseract OCR Result",l=!1,v)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),O(H({id:v,action:"getPDF",payload:{title:a,textonly:l}}))),s=async(a,l)=>{if(R)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return O(H({id:l,action:"detect",payload:{image:await Ce(a)}}))},i=async()=>(d!==null&&(oo(d),d=null),Promise.resolve());ao(d,({workerId:a,jobId:l,status:v,action:E,data:L})=>{const j=`${E}-${l}`;if(v==="resolve"){Ee(`[${a}]: Complete ${l}`);let te=L;E==="recognize"?te=Zt(L):E==="getPDF"&&(te=Array.from({...L,length:Object.keys(L).length})),P[j]({jobId:l,data:te})}else if(v==="reject")if(T[j](L),E==="load"&&I(L),f)f(L);else throw Error(L);else v==="progress"&&S({...L,userJobId:l})});const u={id:w,worker:d,setResolve:W,setReject:V,load:Y,writeText:K,readText:q,removeFile:ee,FS:J,loadLanguage:ae,initialize:M,reinitialize:g,setParameters:C,recognize:x,getPDF:r,detect:s,terminate:i};return X().then(()=>y(n)).then(()=>G(n,e,t)).then(()=>N(u)).catch(()=>{}),B};const Ne=Re,so=async(n,e,c)=>{const t=await Ne(e,1,c);return t.recognize(n).finally(async()=>{await t.terminate()})},no=async(n,e)=>{const c=await Ne("osd",0,e);return c.detect(n).finally(async()=>{await c.terminate()})};var io={recognize:so,detect:no},lo={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},co={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const uo=It,mo=Re,fo=io,ho=lo,go=Oe,bo=co,{setLogging:vo}=le;var po={languages:ho,OEM:go,PSM:bo,createScheduler:uo,createWorker:mo,setLogging:vo,...fo};const yo=Ke(po),wo={name:"EmiratesIdScanner",components:{XMarkIcon:be,BoltIcon:Te,BoltSlashIcon:Ae,ArrowPathIcon:ge,PencilIcon:Fe,ExclamationTriangleIcon:he},emits:["close","data-extracted"],setup(n,{emit:e}){const c=A(null),t=A(null),w=A(!1),S=A(!1),f=A(!1),p=A(!1),P=A(!1),T=A(!1),k=A(!1),h=A(""),m=A("Position Emirates ID in frame"),R=A(!1),I=Pe({first_name:"",last_name:"",emirates_id:""});let N=null,B=null,D=[];const d=async()=>{try{h.value="",D=(await navigator.mediaDevices.enumerateDevices()).filter(x=>x.kind==="videoinput"),P.value=D.length>1;const C={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1};if(N=await navigator.mediaDevices.getUserMedia(C),c.value){c.value.srcObject=N,await new Promise(s=>{c.value.onloadedmetadata=s});const r=N.getVideoTracks()[0].getCapabilities();T.value=!!r.torch,w.value=!0,O()}}catch(g){console.error("Camera initialization error:",g),g.name==="NotAllowedError"?h.value="Camera permission denied. Please allow camera access and try again.":g.name==="NotFoundError"?h.value="No camera found. Please ensure your device has a camera.":g.name==="NotReadableError"?h.value="Camera is being used by another application.":h.value="Unable to access camera. Please check your device settings.",w.value=!1}},W=async()=>{P.value&&(N&&N.getTracks().forEach(g=>g.stop()),w.value=!1,await d())},V=async()=>{if(!(!T.value||!N))try{await N.getVideoTracks()[0].applyConstraints({advanced:[{torch:!k.value}]}),k.value=!k.value}catch(g){console.error("Flash toggle error:",g)}},O=()=>{!w.value||S.value||f.value||(S.value=!0,m.value="Scanning...",B=setInterval(()=>{K()},500))},Y=()=>{S.value=!1,m.value="Scanning paused",B&&(clearInterval(B),B=null)},X=()=>{S.value?Y():O()},K=async()=>{if(!(!c.value||!t.value||!S.value||f.value))try{const g=c.value,C=t.value,x=C.getContext("2d");C.width=g.videoWidth,C.height=g.videoHeight,x.drawImage(g,0,0,C.width,C.height);const r=await q(C);p.value=r,r&&!f.value&&setTimeout(async()=>{if(p.value&&!f.value){const s=C.toDataURL("image/jpeg",.9);await J(s)}},1e3)}catch(g){console.error("Emirates ID detection error:",g),p.value=!1}},q=async g=>{try{const r=g.getContext("2d").getImageData(0,0,g.width,g.height).data;let s=0;const i=30;for(let u=g.height*.3;u<g.height*.7;u+=10)for(let a=g.width*.2;a<g.width*.8;a+=10){const l=(u*g.width+a)*4,v=r[l];if(a<g.width-1){const E=(u*g.width+(a+1))*4,L=r[E];Math.abs(v-L)>i&&s++}if(u<g.height-1){const E=((u+1)*g.width+a)*4,L=r[E];Math.abs(v-L)>i&&s++}}return s>50}catch(C){return console.error("Document detection error:",C),!1}},ee=g=>{const C=document.createElement("canvas"),x=C.getContext("2d"),r=new Image;r.src=g,C.width=r.width,C.height=r.height,x.drawImage(r,0,0);const s=x.getImageData(0,0,C.width,C.height),i=s.data;for(let u=0;u<i.length;u+=4)i[u]=Math.min(255,Math.max(0,(i[u]-128)*1.5+128+20)),i[u+1]=Math.min(255,Math.max(0,(i[u+1]-128)*1.5+128+20)),i[u+2]=Math.min(255,Math.max(0,(i[u+2]-128)*1.5+128+20));return x.putImageData(s,0,0),C.toDataURL("image/png")},J=async g=>{try{f.value=!0,Y();const C=ee(g),{data:{text:x}}=await yo.recognize(C,"eng+ara",{logger:s=>console.log(s),tessedit_char_whitelist:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789- ",preserve_interword_spaces:"1",tessedit_pageseg_mode:"6"});console.log("Full OCR Text:",x);const r=ae(x);console.log("Extracted Data:",r),r&&(r.first_name||r.last_name||r.emirates_id)?(m.value=`Extracted: ${r.first_name?r.first_name+" ":""}${r.last_name?r.last_name+" ":""}${r.emirates_id?"(ID: "+r.emirates_id+")":""}`,e("data-extracted",r)):(m.value="No valid data found, retrying...",setTimeout(()=>{w.value&&O()},1e3))}catch(C){console.error("OCR processing error:",C),m.value="OCR processing failed, retrying...",setTimeout(()=>{w.value&&O()},1e3)}finally{f.value=!1}},ae=g=>{const C=g.replace(/\s+/g," ").trim(),x={first_name:"",last_name:"",emirates_id:""},r=/784[-\s]?\d{4}[-\s]?\d{7}[-\s]?\d{1}/g,s=C.match(r);if(s&&(x.emirates_id=s[0].replace(/\s/g,"").replace(/[^\d-]/g,""),x.emirates_id.length>=15)){const a=x.emirates_id.replace(/-/g,"");a.length===15&&(x.emirates_id=`${a.slice(0,3)}-${a.slice(3,7)}-${a.slice(7,14)}-${a.slice(14,15)}`)}const i=C.split(`
`).map(a=>a.trim()).filter(a=>a.length>0);console.log("OCR Text Lines:",i);let u=!1;for(let a=0;a<i.length&&!u;a++){const l=i[a];if(!(/^\d+$/.test(l)||/emirates|identity|card|authority|uae|الإمارات|هوية|nationality|جنسية|sex|جنس|date|تاريخ|birth|ميلاد/i.test(l)||l.length<2)&&/^[A-Z\s]+$/i.test(l)&&l.length>2){const v=l.split(/\s+/).filter(E=>E.length>1);if(v.length>=2){x.first_name=v[0],x.last_name=v.slice(1).join(" "),u=!0,console.log("Name extracted:",x.first_name,x.last_name);break}else v.length===1&&v[0].length>2&&(x.first_name=v[0],u=!0,console.log("Single name extracted:",x.first_name))}}if(!u){const a=/(name|اسم|الاسم)\s*[:]\s*([A-Z\s]+)/i,l=C.match(a);if(l&&l[2]){const v=l[2].trim().split(/\s+/).filter(E=>E.length>1);v.length>=2&&(x.first_name=v[0],x.last_name=v.slice(1).join(" "),u=!0,console.log("Name extracted from pattern:",x.first_name,x.last_name))}}if(!u){for(const a of i)if(/^[A-Z][a-z]+(\s+[A-Z][a-z]+)+$/.test(a)){const l=a.split(/\s+/);x.first_name=l[0],x.last_name=l.slice(1).join(" "),u=!0,console.log("Title case name extracted:",x.first_name,x.last_name);break}}return x},y=()=>{e("data-extracted",{...I}),R.value=!1,M()},M=()=>{I.first_name="",I.last_name="",I.emirates_id=""},G=()=>{Y(),N&&(N.getTracks().forEach(g=>g.stop()),N=null),w.value=!1};return ve(()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){h.value="Camera not supported on this device";return}d()}),Le(()=>{G()}),{videoElement:c,canvasElement:t,cameraReady:w,isScanning:S,processing:f,documentDetected:p,hasMultipleCameras:P,hasFlash:T,flashOn:k,error:h,scanStatus:m,showManualInput:R,manualForm:I,initializeCamera:d,switchCamera:W,toggleFlash:V,toggleScanning:X,processManualInput:y,clearManualForm:M}}},_o={class:"fixed inset-0 z-50 bg-charcoal-900 flex flex-col"},xo={class:"flex items-center justify-between p-4 bg-charcoal-900/80"},Io={key:1,class:"w-10 h-10"},ko={class:"flex-1 relative"},Eo={ref:"videoElement",class:"w-full h-full object-cover",playsinline:"",muted:"",autoplay:""},Co={ref:"canvasElement",class:"hidden"},So={class:"absolute inset-0 flex items-center justify-center"},Do={key:0,class:"absolute left-0 right-0 h-0.5 bg-emerald-400 opacity-80 animate-scan"},Lo={key:1,class:"absolute top-2 left-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full"},Po={key:0,class:"absolute inset-0 flex items-center justify-center bg-charcoal-900/90"},Ao={class:"bg-white rounded-xl p-6 mx-4 text-center max-w-md"},To={class:"text-charcoal-600 mb-4"},Mo={class:"flex space-x-3"},Oo={key:1,class:"absolute inset-0 flex items-center justify-center bg-charcoal-900/90"},Ro={class:"bg-white rounded-xl p-6 mx-4 text-center max-w-md"},No={class:"p-6 bg-charcoal-900/80"},Fo={class:"text-center mb-4"},Go={key:0,class:"text-white/80 text-sm"},jo={key:1,class:"text-white/80 text-sm"},Uo={key:2,class:"text-emerald-400 text-sm font-medium"},$o={class:"flex items-center justify-center space-x-6"},zo=["disabled"],Bo={key:1,class:"w-12 h-12"},Wo=["disabled"],Vo=["disabled"],qo={key:0,class:"absolute inset-0 z-10 flex items-center justify-center p-4 bg-charcoal-900/80 backdrop-blur-sm"},Yo={class:"bg-white rounded-xl p-6 w-full max-w-md"},Ho={class:"space-y-4"},Ko={class:"flex space-x-3 mt-6"},Jo=["disabled"];function Xo(n,e,c,t,w,S){const f=F("XMarkIcon"),p=F("BoltIcon"),P=F("BoltSlashIcon"),T=F("ExclamationTriangleIcon"),k=F("ArrowPathIcon"),h=F("PencilIcon");return b(),_("div",_o,[o("div",xo,[o("button",{onClick:e[0]||(e[0]=m=>n.$emit("close")),class:"p-2 rounded-lg text-white/80 hover:text-white hover:bg-white/10 transition-colors"},[$(f,{class:"w-6 h-6"})]),e[12]||(e[12]=o("h2",{class:"text-lg font-semibold text-white"},"Scan Emirates ID",-1)),t.hasFlash?(b(),_("button",{key:0,onClick:e[1]||(e[1]=(...m)=>t.toggleFlash&&t.toggleFlash(...m)),class:"p-2 rounded-lg text-white/80 hover:text-white hover:bg-white/10 transition-colors"},[t.flashOn?(b(),ie(P,{key:1,class:"w-6 h-6"})):(b(),ie(p,{key:0,class:"w-6 h-6"}))])):(b(),_("div",Io))]),o("div",ko,[o("video",Eo,null,512),o("canvas",Co,null,512),o("div",So,[o("div",{class:oe(["relative w-80 h-48 max-w-[90vw] max-h-[40vh] border-2 rounded-lg transition-colors duration-300",t.documentDetected?"border-emerald-400 shadow-lg shadow-emerald-400/50":"border-emerald-500"])},[o("div",{class:oe(["absolute -top-1 -left-1 w-6 h-6 border-t-4 border-l-4 rounded-tl transition-colors duration-300",t.documentDetected?"border-emerald-300":"border-emerald-400"])},null,2),o("div",{class:oe(["absolute -top-1 -right-1 w-6 h-6 border-t-4 border-r-4 rounded-tr transition-colors duration-300",t.documentDetected?"border-emerald-300":"border-emerald-400"])},null,2),o("div",{class:oe(["absolute -bottom-1 -left-1 w-6 h-6 border-b-4 border-l-4 rounded-bl transition-colors duration-300",t.documentDetected?"border-emerald-300":"border-emerald-400"])},null,2),o("div",{class:oe(["absolute -bottom-1 -right-1 w-6 h-6 border-b-4 border-r-4 rounded-br transition-colors duration-300",t.documentDetected?"border-emerald-300":"border-emerald-400"])},null,2),t.isScanning&&t.documentDetected?(b(),_("div",Do)):z("",!0),t.documentDetected?(b(),_("div",Lo," Document detected ")):z("",!0)],2)]),e[16]||(e[16]=o("div",{class:"absolute inset-0 bg-charcoal-900/60 mask-id-scanner"},null,-1)),t.error?(b(),_("div",Po,[o("div",Ao,[$(T,{class:"w-12 h-12 text-red-500 mx-auto mb-4"}),e[13]||(e[13]=o("h3",{class:"text-lg font-semibold text-charcoal-900 mb-2"}," Camera Error ",-1)),o("p",To,U(t.error),1),o("div",Mo,[o("button",{onClick:e[2]||(e[2]=(...m)=>t.initializeCamera&&t.initializeCamera(...m)),class:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Try Again "),o("button",{onClick:e[3]||(e[3]=m=>n.$emit("close")),class:"flex-1 px-4 py-2 bg-charcoal-100 text-charcoal-700 rounded-lg hover:bg-charcoal-200 transition-colors"}," Cancel ")])])])):z("",!0),t.processing?(b(),_("div",Oo,[o("div",Ro,[$(k,{class:"w-12 h-12 text-gray-700 mx-auto mb-4 animate-spin"}),e[14]||(e[14]=o("h3",{class:"text-lg font-semibold text-charcoal-900 mb-2"}," Processing ID ",-1)),e[15]||(e[15]=o("p",{class:"text-charcoal-600"}," Extracting information from Emirates ID... ",-1))])])):z("",!0)]),o("div",No,[o("div",Fo,[t.cameraReady?t.isScanning?(b(),_("p",Uo,U(t.documentDetected?"Scanning Emirates ID...":"Detecting document..."),1)):(b(),_("p",jo,U(t.documentDetected?"Document detected - ready to scan":t.scanStatus),1)):(b(),_("p",Go," Initializing camera... "))]),o("div",$o,[t.hasMultipleCameras?(b(),_("button",{key:0,onClick:e[4]||(e[4]=(...m)=>t.switchCamera&&t.switchCamera(...m)),disabled:!t.cameraReady,class:"p-3 rounded-full bg-white/10 text-white hover:bg-white/20 transition-colors disabled:opacity-50"},[$(k,{class:"w-6 h-6"})],8,zo)):(b(),_("div",Bo)),o("button",{onClick:e[5]||(e[5]=(...m)=>t.toggleScanning&&t.toggleScanning(...m)),disabled:!t.cameraReady||t.processing,class:oe(["px-6 py-3 rounded-full font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",t.isScanning?"bg-red-600 text-white hover:bg-red-700":"bg-gray-600 text-white hover:bg-gray-700"])},U(t.isScanning?"Stop Scan":"Start Scan"),11,Wo),o("button",{onClick:e[6]||(e[6]=m=>t.showManualInput=!0),disabled:t.processing,class:"p-3 rounded-full bg-white/10 text-white hover:bg-white/20 transition-colors disabled:opacity-50"},[$(h,{class:"w-6 h-6"})],8,Vo)]),e[17]||(e[17]=o("div",{class:"text-center mt-4"},[o("p",{class:"text-white/60 text-xs"}," Position the front of the Emirates ID within the frame. Scanning will start automatically when a document is detected. ")],-1))]),t.showManualInput?(b(),_("div",qo,[o("div",Yo,[e[21]||(e[21]=o("h3",{class:"text-lg font-semibold text-charcoal-900 mb-4"}," Enter Details Manually ",-1)),o("div",Ho,[o("div",null,[e[18]||(e[18]=o("label",{class:"block text-sm font-medium text-charcoal-700 mb-2"}," First Name ",-1)),se(o("input",{"onUpdate:modelValue":e[7]||(e[7]=m=>t.manualForm.first_name=m),type:"text",placeholder:"Enter first name...",class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent"},null,512),[[ne,t.manualForm.first_name]])]),o("div",null,[e[19]||(e[19]=o("label",{class:"block text-sm font-medium text-charcoal-700 mb-2"}," Last Name ",-1)),se(o("input",{"onUpdate:modelValue":e[8]||(e[8]=m=>t.manualForm.last_name=m),type:"text",placeholder:"Enter last name...",class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent"},null,512),[[ne,t.manualForm.last_name]])]),o("div",null,[e[20]||(e[20]=o("label",{class:"block text-sm font-medium text-charcoal-700 mb-2"}," Emirates ID ",-1)),se(o("input",{"onUpdate:modelValue":e[9]||(e[9]=m=>t.manualForm.emirates_id=m),type:"text",placeholder:"784-1234-1234567-1",class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent"},null,512),[[ne,t.manualForm.emirates_id]])]),o("div",Ko,[o("button",{onClick:e[10]||(e[10]=(...m)=>t.processManualInput&&t.processManualInput(...m)),disabled:!t.manualForm.first_name||!t.manualForm.last_name||!t.manualForm.emirates_id,class:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Use Details ",8,Jo),o("button",{onClick:e[11]||(e[11]=m=>{t.showManualInput=!1,t.clearManualForm()}),class:"flex-1 px-4 py-2 bg-charcoal-100 text-charcoal-700 rounded-lg hover:bg-charcoal-200 transition-colors"}," Cancel ")])])])])):z("",!0)])}const Zo=ue(wo,[["render",Xo],["__scopeId","data-v-90d89a49"]]),Qo={name:"GiftIssueSuccessModal",components:{CheckCircleIcon:Ge},emits:["close","issue-another"]},ea={class:"fixed inset-0 z-50 bg-charcoal-900/80 flex items-center justify-center p-4"},ta={class:"bg-white rounded-xl shadow-2xl p-8 mx-4 text-center max-w-md w-full animate-scale-in"},oa={class:"w-16 h-16 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center"},aa={class:"space-y-3"};function ra(n,e,c,t,w,S){const f=F("CheckCircleIcon");return b(),_("div",ea,[o("div",ta,[o("div",oa,[$(f,{class:"w-10 h-10 text-gray-700"})]),e[2]||(e[2]=o("h3",{class:"text-xl font-semibold text-charcoal-900 mb-3"}," Gift Issued Successfully! ",-1)),e[3]||(e[3]=o("p",{class:"text-charcoal-600 mb-8"}," The gift has been successfully issued and recorded in the system. ",-1)),o("div",aa,[o("button",{onClick:e[0]||(e[0]=p=>n.$emit("issue-another")),class:"w-full px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"}," Issue Another Gift "),o("button",{onClick:e[1]||(e[1]=p=>n.$emit("close")),class:"w-full px-6 py-3 border border-charcoal-300 text-charcoal-700 rounded-lg hover:bg-charcoal-50 transition-colors"}," Back to Dashboard ")])])])}const sa=ue(Qo,[["render",ra],["__scopeId","data-v-bdc027dd"]]),na={name:"GiftIssueFlow",components:{ArrowLeftIcon:ze,ArrowPathIcon:ge,GiftIcon:$e,CameraIcon:De,PhotoIcon:Je,XMarkIcon:be,DocumentTextIcon:Ue,ExclamationTriangleIcon:he,InformationCircleIcon:je,CameraModal:pt,EmiratesIdScanner:Zo,GiftIssueSuccessModal:sa},setup(){const n=qe(),e=We(),{showNotification:c}=Ye(),t=A(!0),w=A(!1),S=A(""),f=A({}),p=A(!1),P=A(!1),T=A(!1),k=A(!1),h=A(""),m=A(null),R=A({}),I=Pe({first_name:"",last_name:"",emirates_id:"",mobile_number:"",person_photo:"",date:new Date().toISOString().split("T")[0]}),N=async()=>{try{t.value=!0,S.value="";const y=e.params.id;if(!y)throw new Error("Gift ID is required");const M=await Ve.getDetails(y);if(!M.success)throw new Error(M.error||"Failed to load gift details");const G=M.data.gift||M.data;if(console.log("Gift API Response:",M.data),console.log("Extracted Gift Data:",G),f.value=G,f.value.status!=="Available"){let g=`This gift is currently "${f.value.status}"`;if(f.value.status==="Issued"){const C=f.value.issued_date||"unknown date",x=`${f.value.first_name||""} ${f.value.last_name||""}`.trim();g+=x?` and was issued to ${x} on ${C}`:` on ${C}`}throw g+='. Only "Available" gifts can be issued.',new Error(g)}}catch(y){console.error("Failed to load gift details:",y),S.value=y.message}finally{t.value=!1}},B=()=>{p.value=!0},D=()=>{var y;(y=m.value)==null||y.click()},d=async y=>{const M=y.target.files[0];M&&await V(M)},W=async y=>{p.value=!1,await V(y)},V=async y=>{try{console.log("Starting photo upload...",y);const M=new FileReader;M.onload=g=>{h.value=g.target.result,console.log("Photo preview set successfully")},M.readAsDataURL(y),console.log("Uploading to server...");const G=await He.upload(y,!0);if(console.log("Upload result:",G),G&&G.success)I.person_photo=G.data.file_url,console.log("Photo URL saved:",G.data.file_url),c("Photo uploaded successfully","success");else throw new Error((G==null?void 0:G.error)||"Failed to upload photo")}catch(M){console.error("Photo upload error:",M),c(`Failed to upload photo: ${M.message}`,"error")}},O=()=>{h.value="",I.person_photo="",m.value&&(m.value.value="")},Y=y=>{P.value=!1,y.first_name&&(I.first_name=y.first_name),y.last_name&&(I.last_name=y.last_name),y.emirates_id&&(I.emirates_id=y.emirates_id),c("Emirates ID data extracted successfully","success")},X=async()=>{if(R.value={},I.first_name.trim()||(R.value.first_name="First name is required"),I.last_name.trim()||(R.value.last_name="Last name is required"),!I.emirates_id.trim())R.value.emirates_id="Emirates ID is required";else{const y=await xe.validateEmiratesId(I.emirates_id);y.success?y.data.valid?I.emirates_id=y.data.formatted_id:R.value.emirates_id=y.data.error:R.value.emirates_id=y.error}return I.mobile_number&&!/^(\+971|971|0)?[0-9]{8,9}$/.test(I.mobile_number.replace(/[\s-]/g,""))&&(R.value.mobile_number="Please enter a valid UAE mobile number"),Object.keys(R.value).length===0},K=async()=>{if(await X())try{w.value=!0;const M={gift:f.value.name,first_name:I.first_name,last_name:I.last_name,emirates_id:I.emirates_id,mobile_number:I.mobile_number,person_photo:I.person_photo,date:I.date},G=await xe.create(M);if(!G.success)throw new Error(G.error||"Failed to issue gift");k.value=!0}catch(M){console.error("Failed to submit gift issue:",M),c(M.message||"Failed to issue gift","error")}finally{w.value=!1}},q=()=>{k.value=!1,n.push("/")},ee=()=>{k.value=!1,n.push("/scan")},J=y=>new Intl.NumberFormat("en-AE",{style:"currency",currency:"AED"}).format(y||0),ae=y=>{if(!y)return"N/A";try{const M=new Date(y);return new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(M)}catch{return y}};return ve(()=>{N()}),{loading:t,submitting:w,error:S,gift:f,form:I,errors:R,showCamera:p,showEmiratesIdScanner:P,showAdditionalDetails:T,showSuccessModal:k,capturedPhoto:h,galleryInput:m,loadGiftDetails:N,openCamera:B,openGallery:D,handleGalleryPhoto:d,handleCapturedPhoto:W,clearPhoto:O,handleEmiratesIdData:Y,submitGiftIssue:K,handleSuccessModalClose:q,handleIssueAnother:ee,formatCurrency:J,formatDate:ae}}},ia={class:"min-h-screen bg-desert-sand-50 pb-safe"},la={class:"absolute top-4 left-4 z-10"},ca={key:0,class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},da={class:"bg-white rounded-xl shadow-card p-6 text-center"},ua={key:1,class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ma={class:"bg-white rounded-xl shadow-card p-6 text-center"},fa={class:"text-charcoal-600 mb-4"},ha={key:2,class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-24 space-y-8"},ga={class:"bg-white rounded-xl shadow-card p-6"},ba={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},va={class:"lg:col-span-1"},pa={class:"aspect-square rounded-lg overflow-hidden bg-charcoal-100"},ya=["src","alt"],wa={key:1,class:"w-full h-full flex items-center justify-center"},_a={class:"lg:col-span-2"},xa={class:"flex items-center justify-between mb-4"},Ia={class:"text-2xl font-bold text-charcoal-900"},ka={key:0,class:"text-charcoal-600 mb-4"},Ea={class:"bg-charcoal-50 rounded-lg p-4"},Ca={class:"w-full"},Sa={class:"space-y-2"},Da={class:"border-b border-charcoal-200 last:border-b-0"},La={class:"py-2 text-charcoal-900 capitalize"},Pa={class:"border-b border-charcoal-200 last:border-b-0"},Aa={class:"py-2 text-charcoal-900 font-medium"},Ta={class:"border-b border-charcoal-200 last:border-b-0"},Ma={class:"py-2 text-charcoal-900 font-mono"},Oa={class:"py-2"},Ra={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},Na={class:"bg-white rounded-xl shadow-card p-6"},Fa={class:"flex items-center justify-between mb-6"},Ga={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ja={key:0,class:"mt-1 text-sm text-red-600"},Ua={key:0,class:"mt-1 text-sm text-red-600"},$a={key:0,class:"mt-1 text-sm text-red-600"},za={key:0,class:"mt-1 text-sm text-red-600"},Ba={class:"bg-white rounded-xl shadow-card p-6"},Wa={class:"mb-6"},Va={key:0,class:"relative inline-block"},qa=["src"],Ya={key:1,class:"w-32 h-32 border-2 border-dashed border-charcoal-300 rounded-lg flex items-center justify-center bg-charcoal-50"},Ha={class:"flex flex-wrap gap-3"},Ka={class:"flex justify-center pt-6"},Ja=["disabled"],Xa={key:0,class:"flex items-center justify-center"},Za={key:1},Qa={key:6,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-charcoal-900/80 backdrop-blur-sm"},er={class:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto"},tr={class:"flex items-center justify-between mb-4"},or={class:"space-y-4"},ar={key:0},rr={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},sr=["src","alt"],nr={key:1},ir={class:"bg-charcoal-50 rounded-lg p-4"},lr={class:"w-full"},cr={class:"py-3 text-sm font-medium text-charcoal-600 w-1/3"},dr={class:"py-3 text-charcoal-900"},ur={class:"bg-charcoal-50 rounded-lg p-4"},mr={class:"w-full"},fr={class:"border-b border-charcoal-200"},hr={class:"py-3 text-charcoal-900"},gr={class:"border-b border-charcoal-200"},br={class:"py-3 text-charcoal-900"},vr={class:"py-3 text-charcoal-900"},pr={class:"flex justify-end mt-6"};function yr(n,e,c,t,w,S){const f=F("ArrowLeftIcon"),p=F("ArrowPathIcon"),P=F("ExclamationTriangleIcon"),T=F("GiftIcon"),k=F("InformationCircleIcon"),h=F("DocumentTextIcon"),m=F("XMarkIcon"),R=F("CameraIcon"),I=F("PhotoIcon"),N=F("GiftIssueSuccessModal"),B=F("CameraModal"),D=F("EmiratesIdScanner");return b(),_("div",ia,[o("div",la,[o("button",{onClick:e[0]||(e[0]=d=>n.$router.push("/scan")),class:"p-3 rounded-full bg-white/90 backdrop-blur-sm text-charcoal-600 hover:bg-white hover:text-charcoal-900 transition-colors shadow-lg"},[$(f,{class:"w-6 h-6"})])]),t.loading?(b(),_("div",ca,[o("div",da,[$(p,{class:"w-8 h-8 mx-auto mb-4 animate-spin text-gray-700"}),e[17]||(e[17]=o("p",{class:"text-charcoal-600"},"Loading gift details...",-1))])])):t.error?(b(),_("div",ua,[o("div",ma,[$(P,{class:"w-12 h-12 mx-auto mb-4 text-red-500"}),e[18]||(e[18]=o("h3",{class:"text-lg font-semibold text-charcoal-900 mb-2"},"Error Loading Gift",-1)),o("p",fa,U(t.error),1),o("button",{onClick:e[1]||(e[1]=(...d)=>t.loadGiftDetails&&t.loadGiftDetails(...d)),class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Try Again ")])])):(b(),_("div",ha,[o("div",ga,[e[24]||(e[24]=o("h2",{class:"text-xl font-semibold text-charcoal-900 mb-6"},"Gift Details",-1)),o("div",ba,[o("div",va,[o("div",pa,[t.gift.images&&t.gift.images.length>0?(b(),_("img",{key:0,src:t.gift.images[0].image,alt:t.gift.gift_name,class:"w-full h-full object-cover"},null,8,ya)):(b(),_("div",wa,[$(T,{class:"w-16 h-16 text-charcoal-400"})]))])]),o("div",_a,[o("div",xa,[o("h3",Ia,U(t.gift.gift_name),1),t.gift.additional_attributes&&t.gift.additional_attributes.length>0?(b(),_("button",{key:0,onClick:e[2]||(e[2]=d=>t.showAdditionalDetails=!0),class:"text-sm text-gray-700 hover:text-gray-800 font-medium flex items-center"},[$(k,{class:"w-4 h-4 mr-1"}),e[19]||(e[19]=ce(" View Details ",-1))])):z("",!0)]),t.gift.description?(b(),_("p",ka,U(t.gift.description),1)):z("",!0),o("div",Ea,[o("table",Ca,[o("tbody",Sa,[o("tr",Da,[e[20]||(e[20]=o("td",{class:"py-2 text-sm font-medium text-charcoal-500 w-1/3"},"Category",-1)),o("td",La,U(t.gift.category),1)]),o("tr",Pa,[e[21]||(e[21]=o("td",{class:"py-2 text-sm font-medium text-charcoal-500 w-1/3"},"Value",-1)),o("td",Aa,U(t.formatCurrency(t.gift.value)),1)]),o("tr",Ta,[e[22]||(e[22]=o("td",{class:"py-2 text-sm font-medium text-charcoal-500 w-1/3"},"Gift Code",-1)),o("td",Ma,U(t.gift.barcode_value),1)]),o("tr",null,[e[23]||(e[23]=o("td",{class:"py-2 text-sm font-medium text-charcoal-500 w-1/3"},"Status",-1)),o("td",Oa,[o("span",Ra,U(t.gift.status),1)])])])])])])])]),o("form",{onSubmit:e[12]||(e[12]=Be((...d)=>t.submitGiftIssue&&t.submitGiftIssue(...d),["prevent"])),class:"space-y-8"},[o("div",Na,[o("div",Fa,[e[26]||(e[26]=o("h2",{class:"text-xl font-semibold text-charcoal-900"},"Person Details",-1)),o("button",{type:"button",onClick:e[3]||(e[3]=d=>t.showEmiratesIdScanner=!0),class:"flex items-center px-3 py-2 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"},[$(h,{class:"w-4 h-4 mr-2"}),e[25]||(e[25]=ce(" Scan Emirates ID Document ",-1))])]),o("div",Ga,[o("div",null,[e[27]||(e[27]=o("label",{for:"first_name",class:"block text-sm font-medium text-charcoal-700 mb-2"}," First Name * ",-1)),se(o("input",{id:"first_name","onUpdate:modelValue":e[4]||(e[4]=d=>t.form.first_name=d),type:"text",required:"",class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent",placeholder:"Enter first name"},null,512),[[ne,t.form.first_name]]),t.errors.first_name?(b(),_("p",ja,U(t.errors.first_name),1)):z("",!0)]),o("div",null,[e[28]||(e[28]=o("label",{for:"last_name",class:"block text-sm font-medium text-charcoal-700 mb-2"}," Last Name * ",-1)),se(o("input",{id:"last_name","onUpdate:modelValue":e[5]||(e[5]=d=>t.form.last_name=d),type:"text",required:"",class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent",placeholder:"Enter last name"},null,512),[[ne,t.form.last_name]]),t.errors.last_name?(b(),_("p",Ua,U(t.errors.last_name),1)):z("",!0)]),o("div",null,[e[29]||(e[29]=o("label",{for:"emirates_id",class:"block text-sm font-medium text-charcoal-700 mb-2"}," Emirates ID * ",-1)),se(o("input",{id:"emirates_id","onUpdate:modelValue":e[6]||(e[6]=d=>t.form.emirates_id=d),type:"text",required:"",pattern:"[0-9]{3}-[0-9]{4}-[0-9]{7}-[0-9]{1}",class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent",placeholder:"784-1234-1234567-1"},null,512),[[ne,t.form.emirates_id]]),t.errors.emirates_id?(b(),_("p",$a,U(t.errors.emirates_id),1)):z("",!0)]),o("div",null,[e[30]||(e[30]=o("label",{for:"mobile_number",class:"block text-sm font-medium text-charcoal-700 mb-2"}," Mobile Number ",-1)),se(o("input",{id:"mobile_number","onUpdate:modelValue":e[7]||(e[7]=d=>t.form.mobile_number=d),type:"tel",class:"w-full px-3 py-2 border border-charcoal-300 rounded-lg text-charcoal-900 placeholder-charcoal-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent",placeholder:"+971 50 123 4567"},null,512),[[ne,t.form.mobile_number]]),t.errors.mobile_number?(b(),_("p",za,U(t.errors.mobile_number),1)):z("",!0)])])]),o("div",Ba,[e[33]||(e[33]=o("h2",{class:"text-xl font-semibold text-charcoal-900 mb-6"},"Person Photo",-1)),o("div",Wa,[t.capturedPhoto||t.form.person_photo?(b(),_("div",Va,[o("img",{src:t.capturedPhoto||t.form.person_photo,alt:"Person photo",class:"w-32 h-32 rounded-lg object-cover border-2 border-charcoal-200"},null,8,qa),o("button",{type:"button",onClick:e[8]||(e[8]=(...d)=>t.clearPhoto&&t.clearPhoto(...d)),class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors"},[$(m,{class:"w-4 h-4"})])])):(b(),_("div",Ya,[$(R,{class:"w-8 h-8 text-charcoal-400"})]))]),o("div",Ha,[o("button",{type:"button",onClick:e[9]||(e[9]=(...d)=>t.openCamera&&t.openCamera(...d)),class:"flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"},[$(R,{class:"w-4 h-4 mr-2"}),e[31]||(e[31]=ce(" Take Photo ",-1))]),o("button",{type:"button",onClick:e[10]||(e[10]=(...d)=>t.openGallery&&t.openGallery(...d)),class:"flex items-center px-4 py-2 bg-charcoal-600 text-white rounded-lg hover:bg-charcoal-700 transition-colors"},[$(I,{class:"w-4 h-4 mr-2"}),e[32]||(e[32]=ce(" Choose from Gallery ",-1))])]),o("input",{ref:"galleryInput",type:"file",accept:"image/*",class:"hidden",onChange:e[11]||(e[11]=(...d)=>t.handleGalleryPhoto&&t.handleGalleryPhoto(...d))},null,544)]),o("div",Ka,[o("button",{type:"submit",disabled:t.submitting,class:"w-full sm:w-auto px-8 py-3 border border-transparent text-sm font-medium rounded-lg text-white bg-gray-600 hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t.submitting?(b(),_("span",Xa,[$(p,{class:"w-4 h-4 mr-2 animate-spin"}),e[34]||(e[34]=ce(" Issuing Gift... ",-1))])):(b(),_("span",Za,"Issue Gift"))],8,Ja)])],32)])),t.showSuccessModal?(b(),ie(N,{key:3,onClose:t.handleSuccessModalClose,onIssueAnother:t.handleIssueAnother},null,8,["onClose","onIssueAnother"])):z("",!0),t.showCamera?(b(),ie(B,{key:4,onClose:e[13]||(e[13]=d=>t.showCamera=!1),onPhotoCaptured:t.handleCapturedPhoto},null,8,["onPhotoCaptured"])):z("",!0),t.showEmiratesIdScanner?(b(),ie(D,{key:5,onClose:e[14]||(e[14]=d=>t.showEmiratesIdScanner=!1),onDataExtracted:t.handleEmiratesIdData},null,8,["onDataExtracted"])):z("",!0),t.showAdditionalDetails?(b(),_("div",Qa,[o("div",er,[o("div",tr,[e[35]||(e[35]=o("h3",{class:"text-lg font-semibold text-charcoal-900"}," Additional Gift Details ",-1)),o("button",{onClick:e[15]||(e[15]=d=>t.showAdditionalDetails=!1),class:"p-2 text-charcoal-500 hover:text-charcoal-700 rounded-lg hover:bg-charcoal-100 transition-colors"},[$(m,{class:"w-5 h-5"})])]),o("div",or,[t.gift.images&&t.gift.images.length>1?(b(),_("div",ar,[e[36]||(e[36]=o("h4",{class:"font-medium text-charcoal-900 mb-3"},"Gift Images",-1)),o("div",rr,[(b(!0),_(we,null,_e(t.gift.images,(d,W)=>(b(),_("div",{key:W,class:"aspect-square rounded-lg overflow-hidden bg-charcoal-100"},[o("img",{src:d.image,alt:`Gift image ${W+1}`,class:"w-full h-full object-cover"},null,8,sr)]))),128))])])):z("",!0),t.gift.additional_attributes&&t.gift.additional_attributes.length>0?(b(),_("div",nr,[e[37]||(e[37]=o("h4",{class:"font-medium text-charcoal-900 mb-3"},"Additional Attributes",-1)),o("div",ir,[o("table",lr,[o("tbody",null,[(b(!0),_(we,null,_e(t.gift.additional_attributes,d=>(b(),_("tr",{key:d.attribute_name,class:"border-b border-charcoal-200 last:border-b-0"},[o("td",cr,U(d.attribute_name),1),o("td",dr,U(d.attribute_value),1)]))),128))])])])])):z("",!0),o("div",null,[e[41]||(e[41]=o("h4",{class:"font-medium text-charcoal-900 mb-3"},"Gift Information",-1)),o("div",ur,[o("table",mr,[o("tbody",null,[o("tr",fr,[e[38]||(e[38]=o("td",{class:"py-3 text-sm font-medium text-charcoal-600 w-1/3"},"Created",-1)),o("td",hr,U(t.formatDate(t.gift.creation)),1)]),o("tr",gr,[e[39]||(e[39]=o("td",{class:"py-3 text-sm font-medium text-charcoal-600 w-1/3"},"Last Modified",-1)),o("td",br,U(t.formatDate(t.gift.modified)),1)]),o("tr",null,[e[40]||(e[40]=o("td",{class:"py-3 text-sm font-medium text-charcoal-600 w-1/3"},"Created By",-1)),o("td",vr,U(t.gift.owner),1)])])])])])]),o("div",pr,[o("button",{onClick:e[16]||(e[16]=d=>t.showAdditionalDetails=!1),class:"px-4 py-2 bg-charcoal-100 text-charcoal-700 rounded-lg hover:bg-charcoal-200 transition-colors"}," Close ")])])])):z("",!0)])}const Ir=ue(na,[["render",yr],["__scopeId","data-v-f2623f4c"]]);export{Ir as default};
